#! /usr/bin/env bash

base_install () {
    # Fix some errors and cleanup
    mkdir -p "$XDG_DATA_HOME"/vim/{undo,swap,backup} # Fixes vim
    touch ~/.vim/cache/viminfo # viminfo
    touch $XDG_DATA_HOME/vim/viminfo # viminfo
    mkdir -p "~/.vim/cache/viminfo" # vim viminfo
    mkdir ~/.cache/zsh
    mkdir ~/.cache/vlc
    sudo mkdir /var/lib/samba/usershares

    # Update
    sudo apt-get update; sudo apt-get full-upgrade
    # System tools
    sudo apt-get install git build-essential file python3 python3-pip npm samba-common-bin fonts-powerline  curl gnome-screensaver arc-theme autoconf automake sassc optipng inkscape gnome-shell libgtk-3-dev pkg-config yarn nodejs
    sudo apt-get install chromium-browser       # Web browser
    sudo apt-get install texlive-full doxygen   # Doxygen
    sudo apt-get install ruby-dev

    # Terminal
    sudo apt-get install stow
    sudo apt-get install subversion             # To download repos
    sudo apt-get install neovim                 # Neovim
    sudo apt-get install zsh
    sudo apt-get install htop                   # Show system resources
    sudo apt-get install ranger w3m             # Ranger
    sudo apt-get install vim-gtk                # Vim with full functionality
    sudo apt-get install silversearcher-ag      # Better and faster ack (and grep)
    sudo apt-get install fzf                    # Fuzzy finder
    sudo apt-get install bat                    # Better cat

    # Tmux
    sudo apt-get install tmux                   # Terminal multiplexer
    # Manage storage
    sudo apt-get install ncdu                   # Manage storage

    # Apps
    sudo apt-get install thunderbird            # Email
    sudo apt-get install transmission           # A simpler Torrent D.
    sudo apt-get install timeshift              # Backups
    sudo apt-get install gparted                # Manage partitions
    sudo apt-get install vlc                    # Media player
    sudo apt-get install pavucontrol            # Audio
    sudo apt-get install virtualbox-qt          # Virtual machines
    sudo apt-get install cpu-checker qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils

    # sudo pip3 install spotify-cli-linux       # Spotify
    sudo apt-get install LXAppearance           # Theme

}
ubuntu_install() {
    if [[ $FirstRun == y ]]; then
        sudo adduser `id -un` libvirt
        sudo adduser `id -un` kvm
    fi
}

brew_install () {
    cd ~/
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
    eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
    brew update
    brew upgrade
    brew install gcc patchelf graphviz
    brew install exa                             # "ls" on steroids
}

chrome_install () {
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo apt install ./google-chrome-stable_current_amd64.deb
    rm google-chrome-stable_current_amd64.deb
}

vim_install () {
    cd ~/
    vim +PlugInstall +qall
    # Vim YouCompleteMe plugin install
    bash ~/scripts/ycm
    sudo npm install -g neovim
    python3 -m pip install --user --upgrade pynvim
    sudo gem install neovim
}

steam_install () {
    wget https://repo.steampowered.com/steam/archive/precise/steam_latest.deb
    sudo apt install ./steam_latest.deb
    rm steam_latest.deb
}

albert_install () {
    if ! command -v albert 2>/dev/null; then
        cd ~/
        curl https://build.opensuse.org/projects/home:manuelschneid3r/public_key | sudo apt-key add -
        echo 'deb http://download.opensuse.org/repositories/home:/manuelschneid3r/xUbuntu_20.04/ /' | sudo tee /etc/apt/sources.list.d/home:manuelschneid3r.list
        sudo wget -nv https://download.opensuse.org/repositories/home:manuelschneid3r/xUbuntu_20.04/Release.key -O "/etc/apt/trusted.gpg.d/home:manuelschneid3r.asc"
        sudo apt-get update
        sudo apt-get install albert
    fi
}

bloat_install () {
    brew install pipes-sh
    sudo apt-get install neofetch cmatrix
    sudo apt-get install cowsay                 # A cow displaying text
    sudo apt-get install fortune                # Random quotes
}

i3_install () {
    sudo add-apt-repository ppa:kgilmer/speed-ricer
    sudo apt-get update
    sudo apt-get install i3-gaps
    sudo apt-get install feh compton rofi i3blocks python-dbus player-ctl pulseaudio
    # Add current user to group video, type groups to see which groups you are in
    sudo usermod -a -G video $LOGNAME
    # Light setup | Enables brightness controls
    git clone https://github.com/haikarainen/light
    ./autogen.sh
    ./configure && make
    sudo make install

    ./configure --with-udev && make
    sudo make install
}

emacs_install () {
    sudo apt-get install emacs-gtk
    # Doom
    # required dependencies
    sudo apt-get install git ripgrep
    # optional dependencies
    sudo apt-get install tar fd-find clang
}


### MAIN
echo "Is it the first time you run this script? [y/n]"
read FirstRun
if [[ $FirstRun == y ]]; then
    echo "#! /bin/sh
    export DISTRO=ubuntu" > ~/.config/distro
fi
ubuntu_minimal_install
if [[ $FirstRun == y ]]; then
    brew_install
    #chrome_install
    #steam_install
    #albert_install
    #vim_install
    #i3_install
fi
#bloat_install
chsh -s $(which zsh) # Change default shell to zsh

### SNAPS
snaps=(dialog --separate-output --checklist "Select which snaps you would like to install" 22 76 16)
options=(1 "Spotify" on
    2 "Discord" on
    3 "Whatsapp" on
    4 "To-do list" off
    5 "Skype" on
    6 "atom" off
    7 "slack" off
    8 "Android Studio" on)
    snap_choices=$("${snaps[@]}" "${options[@]}" 2>&1 >/dev/tty)
    clear
    for choice in $snap_choices
    do
        case $choice in
            1)
                sudo snap install spotify
                ;;
            2)
                sudo snap install discord
                ;;
            3)
                sudo snap install walc
                ;;
            4)
                sudo snap install ao
                ;;
            5)
                sudo snap install android-studio --classic
                ;;
            6)
                sudo snap install skype --classic
                ;;
            7)
                sudo snap install atom --classic
                ;;
            8)
                sudo snap install slack --classic
                ;;
        esac
    done
