#! /usr/bin/env bash
# User name should be pol
# df "check for disk space"
# YOU NEED TO ADD YOURSELF TO WHEEL AND TO VIDEO
# video makes backlight work and wheel gives you sudo privilege
# usermod -a -G wheel video input
# Configure nvidia nvidia-xconfig

# Wallpaper error when background is set in desktop, it will also be used by
# LightDM unless the picture isn't coming from /usr/share/backgrounds

# Neovim is much faster than vim
arch_install () {
    # Fix some errors and cleanup
    mkdir -p "$XDG_DATA_HOME"/vim/{undo,swap,backup} # Fixes vim
    mkdir ~/.cache/zsh
    mkdir ~/.cache/vlc

    # Nemo "best filemanager"
    gsettings set org.cinnamon.desktop.default-applications.terminal exec # Tell Nemo to use Termite instead of gnome-terminal
    gsettings set org.cinnamon.desktop.default-applications.terminal exec-arg -e # Termite execute argument is -e in gnome-terminal its -x
    sudo pacman -S nemo
    sudo pacman -S nemo-fileroller
    sudo pacman -S nemo-preview
    sudo pacman -S nemo-seahorse
    sudo pacman -S nemo-share

    # Terminal
    sudo pacman -S rclone                # Rsync to remote 
    sudo pacman -S thefuck
    sudo pacman -S wget                  # Download stuff
    sudo pacman -S svn
    sudo pacman -S base-devel            # AUR
    sudo pacman -S zsh                   # Zsh shell
    sudo pacman -S termite               # Terminal emulator
    sudo pacman -S gvim                  # Vim version with extra features
    sudo pacman -S exa                   # "ls" on steroids
    sudo pacman -S htop                  # Show system resources
    sudo pacman -S the_silver_searcher   # Better and faster ack (and grep)
    sudo pacman -S fzf                   # Fuzzy finder
    sudo pacman -S bat                   # "Cat" on steroids
    sudo pacman -S tmux                  # Terminal multiplexer
    sudo pacman -S gcc                   # Cpp
    sudo pacman -S git python3 stow      # To deploy dotfiles and more
    sudo pacman -S dhcpcd
    sudo pacman -S ruby
    sudo pacman -S laptop-detect         # Detect if using a laptop
    sudo pacman -S npm
    sudo pacman -S xdg-user-dirs         # Manage user directories like "Downloads" https://wiki.archlinux.org/index.php/XDG_user_directories
    sudo pacman -S reflector             # Update Arch mirrors
    sudo pacman -S dnsutils              # Ip
    sudo pacman -S net-tools             # Ips
    sudo pacman -S ncdu                  # Manage storage
    sudo pacman -S xclip                 # Clipboard
    sudo pacman -S udisks2               # Daemon to manipulate storage devices
    sudo pacman -S udiskie               # Automater
    sudo pacman -S ranger                # Ranger
    sudo pacman -S w3m                   # Preview images on ranger
    sudo pacman -S xorg-xinit            # Start X11 without LightDM "startx"  https://wiki.archlinux.org/index.php/Xinit
    sudo pacman -S xorg                  # Display server

    # GUI
    sudo pacman -S gucharmap             # Characters keyboard
    sudo pacman -S gparted               # Manage partitions
    sudo pacman -S gnome-calculator      # Calculator
    sudo pacman -S meld                  # Best diff viewer "kompare pulls a lot of kde dependencies"
    sudo pacman -S discord
    sudo pacman -S yarn                  # Package installer
    sudo pacman -S file-roller           # Archive Manager
    sudo pacman -S dunst                 # Notifications
    sudo pacman -S calibre               # Book manager
    sudo pacman -S libreoffice-still     # Office
    sudo pacman -S transmission-gtk      # A simpler Torrent D.
    sudo pacman -S vlc                   # Video player

    ### AUR
    yay -S google-chrome                 # Best web browser
    yay -S visual-studio-code-bin       # Microsoft's Visual Code /not #sudo pacman -S code 
    yay -S birdtray                     # Thunderbird tray
    yay -S whatsapp-nativefier          # Whatsapp client
    yay -S spotify                      # Spotify
    yay -S ttf-ms-win10
    yay -S ttf-ms-fonts                 # Microsoft fonts ##deprecated
    yay -S skypeforlinux-stable-bin     # Skype
    yay -S thunderbird-bin               # Might have to manually enter PGP key /not#sudo pacman -S thunderbird

    # Lockscreen
    yay -S betterlockscreen
    sudo pacman -S xss-lock

    # Backups
    yay -S timeshift  #  sudo timeshift-gtk
    sudo pacman -S cron

    # IRC APP
    sudo pacman -S hexchat               # Graphical

    # Drivers
    sudo pacman -S linux-lts
    sudo pacman -S linux-lts-headers
    sudo pacman -S linux-headers
    sudo pacman -S nvidia-lts
    # sudo pacman -S nvidia-dkms #very slow
    sudo pacman -S nvidia nvidia-utils   # Nvidia
    sudo pacman -S xf86-video-intel mesa lib32-mesa    # Intel
    sudo pacman -S lib32-nvidia-utils    # Requires adding multilib libraries
    sudo pacman -S nvidia-settings       # Add force composition pipeline in nvidia-settings

    # Pdf viewer
    sudo pacman -S okular # or  sudo pacman -S zathura zathura-pdf-mupdf zathura-cb

    # Audio | Equalizer qpaeq
    sudo pacman -S playerctl
    sudo pacman -S pulseaudio pulseaudio-equalizer pulseaudio-bluetooth

    # Apps
    sudo pacman -S tumbler ffmpegthumbnailer raw-thumbnailer

    # Theme
    sudo pacman -S lxappearance           # Gtk configuration utility
    sudo pacman -S gtk2 gtk3
    sudo pacman -S arc-gtk-theme arc-icon-theme # Arc theme and its icon's
    sudo pacman -S adapta-gtk-theme       # Alternative theme
    sudo pacman -S papirus-icon-theme     # Best icon theme!
    sudo pacman -S qt5ct                  # Qt5 configuration utility
    sudo pacman -S kvantum-qt5            # Qt5 Custom themes
    sudo pacman -S breeze                 # Theme
    sudo pacman -S dconf-editor           # Edit gnome configuration
    #https://wiki.archlinux.org/index.php/Uniform_look_for_Qt_and_GTK_applications
    #https://wiki.archlinux.org/index.php/qt

    # Fonts
    sudo pacman -S gnome-font-viewer      # Font viewer
    sudo pacman -S noto-fonts-emoji       # Classic Emoji
    sudo pacman -S ttf-dejavu ttf-liberation ttf-droid ttf-ubuntu-font-family ttf-roboto noto-fonts

    # Printers
    # https://wiki.archlinux.org/index.php/CUPS
    sudo pacman -S cups system-config-printer hplip
    if [[ $FirstRun == y || $FirstRun == Y ]]; then
        sudo systemctl enable org.cups.cupsd.service
        sudo systemctl start org.cups.cupsd.service
    fi

    # Bluetooth
    sudo pacman -S bluez bluez-utils
    sudo pacman -S blueberry              # Linux Mint spin-off of GNOME Bluetooth
    if [[ $FirstRun == y || $FirstRun == Y ]]; then
        systemctl enable bluetooth.service
    fi

    # Display manager
    if [[ $FirstRun == y || $FirstRun == Y ]]; then
        systemctl enable lightdm.service
    fi
    sudo pacman -S lightdm-gtk-greeter lightdm lightdm-gtk-greeter-settings
    # Ntp for time syncro
    #https://wiki.archlinux.org/index.php/Systemd-timesyncd
    if [[ $FirstRun == y || $FirstRun == Y ]]; then
        systemctl enable systemd-timesyncd.service
        systemctl disable ntpd.service
    fi
    # https://wiki.archlinux.org/index.php/USB_storage_devices
    # Network Manager and enable daemon on startup
    sudo pacman -S networkmanager
    if [[ $FirstRun == y || $FirstRun == Y ]]; then
        systemctl enable NetworkManager.service
    fi
    # Gui
    sudo pacman -S nm-connection-editor
    # Applet
    sudo pacman -S nm-applet

}
yay_install() {
    cd ~/
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si
    sudo rm -r /home/pol/yay
}

# do this but i dont know exactly how
#do_once () {
#    sudo echo 'Section "InputClass"
#    Identifier "libinput touchpad catchall"
#    MatchIsTouchpad "on"
#    MatchDevicePath "/dev/input/event*"
#    Driver "libinput"
#    Option "NaturalScrolling" "true"
#    EndSection'  >> /etc/X11/xorg.conf.d/30-touchpad.conf
#}

vim_install () {
    sudo pacman -S neovim
    cd ~/
    vim +PlugInstall +qall
    # Vim YouCompleteMe plugin install
    bash ~/scripts/ycm.sh
    sudo pacman -S python2 python-pip
    sudo npm install -g neovim
    python3 -m pip install --user --upgrade pynvim
    sudo gem install neovim
}

# Best Tiling Window Manager
i3_install () {
    sudo pacman -S i3-gaps   # i3 with gaps
    sudo pacman -S rofi      # App menu Super+d
    sudo pacman -S i3blocks  # Bottom bar
    sudo pacman -S picom     # Compositor, for transparencies
    sudo pacman -S feh       # Wallpaper
    sudo pacman -S light     # Brightness
    sudo pacman -S acpi
    sudo pacman -S perl-anyevent-i3 python-dbus
    sudo pacman -S awk bc upower             # battery plus
    sudo pacman -S yad xdotool               # calendar
    sudo pacman -S pulseaudio alsa-utils     # Audio
}
# Best Desktop
cinnamon_install() {
    sudo pacman -S cinnamon                  # Desktop
    sudo pacman -S gnome-screenshot          # Take screenshots with impr pant
    yay -S cinnamon-sound-effects            # Sound effects
    yay -S mint-themes mint-y-icons mint-backgrounds # Themes
    yay -S pix                               # Image viewer
    gsettings set org.cinnamon.desktop.wm.preferences resize-with-right-button true # alt + rightclick to resize windows

    # Fallback mode in case cinnamon crashes
    sudo pacman -S metacity
    sudo pacman -S gnome-shell               # To have a taskbar

    # Color pick applet
    sudo pacman -S python-numpy python-xlib

    # Uninstall  xf86-video-intel
    #https://wiki.archlinux.org/index.php/cinnamon

    # To fix laggy animations
    #https://www.reddit.com/r/linuxmint/comments/7v2jt6/laggy_cinnamon_animations/
    # Edit animation time (0.05)/usr/share/cinnamon/js/ui/expo.js 
    # and /usr/share/cinnamon/js/ui/overview.js
}
gnome_install() {
    sudo pacman -S chrome-gnome-shell 
    # Extensions
    # dash to dock (add dock)
    # impatience (faster animations)
    # auto move windows (move apps to workspaces automatically)
    # WinTile (tile quarter windows)
    # cpu power manager (cpu management)
}
plasma_install() {
    sudo pacman -S plasma # Check archwiki first
    yay -S ocs-url # Easy install of kde store add-ons
}
bloat_install () {
    sudo pacman -S fortune-mod           # Random quote
    sudo pacman -S cmatrix               # Bloat
    sudo pacman -S lolcat
    sudo pacman -S cowsay    # A cow displaying text
    sudo pacman -S ponysay asciiquarium
    sudo pacman -S sl        # Steam locomotor, (Did you mean to type ls?)
    yay -S pipes.sh          # Lockscreens
    yay -S figlet toilet     # Cool letters
    yay -S cava # https://github.com/karlstav/cava
}
virtualbox_install() {
    sudo pacman -S virtualbox
    # Need to activate virtualization in bios
    # 'linux' kernel
    sudo pacman -S virtualbox-host-modules-arch
    # other kernels including linux-lts
    sudo pacman -S virtualbox-host-dkms
}
games_install () {
    sudo pacman -S steam
    sudo pacman -S lutris
    sudo pacman -S minecraft
}
laptop_install() {
    sudo pacman -S tlp
    sudo systemctl enable tlp.service
}
DWall() {
    cd $HOME
    git clone https://github.com/adi1090x/dynamic-wallpaper.git
    cd dynamic-wallpaper
    chmod +x install.sh
    ./install.sh
    cd $HOME
    sudo rm -r ~/home/pol/dynamic-wallpaper
}
optional() {
    # Terminal
    sudo pacman -S doxygen texlive-most graphviz # Doxygen
    #sudo pacman -S github-cli            # Github from terminal, create issues...

    # GUI
    #sudo pacman -S nomacs                # Image viewer / use pix instead
    sudo pacman -S r                    # Probabilitat i estadística
    sudo pacman -S dbeaver               # Base de dades
    sudo pacman -S jdk-openjdk # with dbeaver
    sudo pacman -S remmina               # Remote conexions
    sudo pacman -S texstudio             # Latex text editor
    sudo pacman -S gimp                  # Image editor
    sudo pacman -S audacity              # Audio editor

    # AUR
    yay -S youtube-dl                   # Download youtube videos
    yay -S rstudio-desktop-bin          # Probabilitat i estadística IDE
    yay -S slack-desktop                # Slack
    yay -S android-studio               # Android Studio
    sudo pacman -S tor                   # Tor private browser
    yay -S tor-browser
    # f5fpc -s -x -t https://upclink.upc.edu
    # f5fpc --stop
    yay -S f5fpc                        # Connexio a UPClink

    # Calendar
    #sudo pacman -S gnome-calendar gnome-keyring libsecret seahorse

    # Arduino
    #if [[ $FirstRun == y || $FirstRun == Y ]]; then
    #    usermod -aG uucp,lock pol
    #fi
    #sudo pacman -S arduino-avr-core
    #sudo pacman -S arduino
}

### Installation starts here

echo "Is it the first time you run this script? [y/n]"
read FirstRun
cd ~/
# Distro variable
if [[ $FirstRun == y || $FirstRun == Y ]]; then
    echo "#! /bin/sh
    export DISTRO=arch" > ~/.config/distro
fi
sudo pacman -Syu # Update
arch_install
i3_install
cinnamon_install
if [[ $FirstRun == y || $FirstRun == Y ]]; then
    yay_install
    #optional
    vim_install
    wget -qO- https://git.io/papirus-folders-install | sh # Install folder colors https://github.com/PapirusDevelopmentTeam/papirus-folders
    laptop_install
    #games_install
    cava_install
    applets             # Installs Cinnamon applets
    #bloat_install
    DWall
fi
chsh -s $(which zsh) # Change default shell to zsh
