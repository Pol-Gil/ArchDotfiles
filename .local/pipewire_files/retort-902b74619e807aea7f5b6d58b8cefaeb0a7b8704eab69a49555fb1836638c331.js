Ember.TEMPLATES["javascripts/connectors/above-footer/emoji-picker-wrapper"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"emoji-picker",null,[["retort","isActive","post","emojiSelected","onEmojiPickerClose"],[true,[24,["isActive"]],[24,["post"]],[24,["emojiSelected"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["isActive"]]],null],false],null]]]],false]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/above-footer/emoji-picker-wrapper"}}),define("discourse/plugins/retort/discourse/lib/retort",["exports","discourse/lib/ajax","discourse/lib/ajax-error"],function(e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=Ember.Object.create({topic:{postStream:{posts:[]}},initialize:function(e,t){var o=this;this.topic.id&&e.unsubscribe("/retort/topics/".concat(this.topic.id)),this.set("topic",t),e.subscribe("/retort/topics/".concat(this.topic.id),function(e){var t=e.id,i=e.retorts,e=o.postFor(t);e&&(e.setProperties({retorts:i}),o.get("widgets.".concat(t)).scheduleRerender())})},postFor:function(t){return(this.get("topic.postStream.posts")||[]).find(function(e){return e.id==t})},storeWidget:function(e){this.get("widgets")||this.set("widgets",{}),this.set("widgets.".concat(e.getModel().id),e.widget)},updateRetort:function(e,t){e=e.id;return(0,i.ajax)("/retorts/".concat(e,".json"),{type:"POST",data:{retort:t}}).catch(o.popupAjaxError)},disabledCategories:function(){return Discourse.SiteSettings.retort_disabled_categories.split("|").map(function(e){return e.toLowerCase()}).filter(Boolean)},disabledFor:function(e){var t=this.postFor(e);if(!t)return!0;if(!t.topic.details.can_create_post)return!0;if(t.get("topic.archived"))return!0;e=t.get("topic.category.name"),t=this.disabledCategories();return e&&t.includes(e.toString().toLowerCase())},openPicker:function(e){this.set("picker.isActive",!0),this.set("picker.post",e)},setPicker:function(t){var i=this;this.set("picker",t),this.set("picker.emojiSelected",function(e){return i.updateRetort(t.post,e).then(function(){return t.set("isActive",!1)})})}});e.default=t}),define("discourse/plugins/retort/discourse/initializers/retort-init",["exports","discourse/lib/plugin-api","discourse/lib/text","@ember/runloop","discourse-common/utils/decorators","@ember/object","@popperjs/core","discourse/lib/utilities","pretty-text/emoji","discourse/routes/topic","../lib/retort","discourse/models/user"],function(e,t,c,a,u,l,d,p,m,i,f,h){"use strict";function v(i,o,e,t,r){var s={};return Object.keys(t).forEach(function(e){s[e]=t[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=e.slice().reverse().reduce(function(e,t){return t(i,o,e)||e},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,o,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={name:"retort-button",initialize:function(){(0,t.withPluginApi)("0.8.6",function(e){return i=(t=e).container.lookup("site-settings:main"),o=i.retort_enabled,r=i.retort_allowed_emojis,s=i.retort_limited_emoji_set,n=t.container.lookup("message-bus:main"),t.decorateWidget("post-contents:after-cooked",function(i){var e=i.getModel().id,o=f.default.postFor(e);if(!f.default.disabledFor(e)&&(f.default.storeWidget(i),o.retorts))return o.retorts.map(function(e){var t=e.usernames,e=e.emoji;return i.attach("retort-toggle",{post:o,usernames:t,emoji:e})})}),void(h.default.current()&&o&&(t.modifyClass("route:topic",{setupController:function(e,t){f.default.initialize(n,t),this._super(e,t)}}),t.addPostMenuButton("retort",function(e){if(!f.default.disabledFor(e.id))return{action:"clickRetort",icon:"far-smile",title:"retort.title",position:"first",className:"retort"}}),t.attachWidgetAction("post-menu","clickRetort",function(){f.default.openPicker(this.findAncestorModel())}),t.modifyClass("component:emoji-picker",(e=(0,u.default)("retort"),i=(0,u.default)("retort","isActive"),o=(0,u.observes)("isActive"),v(t={limited:function(){return this.retort&&s},activeRetort:function(){return this.retort&&this.isActive},_setup:function(){this.retort?this._setupRetort():this._super()},_setupRetort:function(){this.isActive?this.onShowRetort():this.onClose()},onShowRetort:function(){var i=this;this.limited||this.set("isLoading",!0),(0,a.schedule)("afterRender",function(){document.addEventListener("click",i.handleOutsideClick);var e=i.post,t=document.querySelector(".emoji-picker"),e=document.querySelector('\n          article[data-post-id="'.concat(e.id,'"] .post-controls .retort'));if(!t||!e)return!1;i.site.isMobileDevice||(i._popper=(0,d.createPopper)(e,t,{placement:i.limited?"top":"bottom"})),i.limited?(e=r.split("|"),i._emojisPerRow[e.length],t.innerHTML="\n            <div class='limited-emoji-set'>\n              ".concat(e.map(function(e){return'<img\n                src="'.concat((0,c.emojiUrlFor)(e),"\"\n                width=40\n                height=40\n                title='").concat(e,"'\n                class='emoji' />")}).join(""),"\n            </div>\n          "),t.classList.add("has-limited-set"),t.onclick=function(e){e.target.classList.contains("emoji")?i.emojiSelected(e.target.title):(i.set("isActive",!1),i.onClose())}):(t.querySelectorAll(".emojis-container .section .section-header").forEach(function(e){return i._sectionObserver.observe(e)}),(0,a.later)(function(){i.set("isLoading",!1),i.applyDiscourseTrick(t)},50))})},applyDiscourseTrick:function(t){var i=this;(0,a.schedule)("afterRender",function(){var e;i.site.isMobileDevice&&!i.isEditorFocused||(0,p.safariHacksDisabled)()||(e=t.querySelector("input.filter"))&&e.focus(),0!==i.selectedDiversity&&i._applyDiversity(i.selectedDiversity)})},onCategorySelection:function(e){e=document.querySelector('.emoji-picker-emoji-area .section[data-section="'.concat(e,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},onFilter:function(e){var t=document.querySelector(".emoji-picker-emoji-area"),i=t.querySelector(".emojis-container"),t=t.querySelector(".results");t.innerHTML="",e.target.value?(t.innerHTML=(0,m.emojiSearch)(e.target.value.toLowerCase(),{maxResults:10,diversity:this.emojiStore.diversity}).map(this._replaceEmoji).join(""),i.style.visibility="hidden",t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):i.style.visibility="visible"},_emojisPerRow:{0:1,1:1,2:2,3:3,4:4,5:5,6:3,7:3,8:4,9:3,10:5,11:5,12:4,13:5,14:7,15:5,16:4,17:5,18:6,19:6,20:5,21:7,22:5,23:5,24:6}},"limited",[e],Object.getOwnPropertyDescriptor(t,"limited"),t),v(t,"activeRetort",[i],Object.getOwnPropertyDescriptor(t,"activeRetort"),t),v(t,"_setup",[o],Object.getOwnPropertyDescriptor(t,"_setup"),t),v(t,"onShowRetort",[l.action],Object.getOwnPropertyDescriptor(t,"onShowRetort"),t),v(t,"onCategorySelection",[l.action],Object.getOwnPropertyDescriptor(t,"onCategorySelection"),t),v(t,"onFilter",[l.action],Object.getOwnPropertyDescriptor(t,"onFilter"),t),t))));var t,i,o,r,s,n})}};e.default=o}),define("discourse/plugins/retort/discourse/widgets/retort-toggle",["exports","virtual-dom","discourse/lib/text","discourse/widgets/widget","../lib/retort"],function(e,i,o,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});t=(e.default=void 0,t.createWidget)("retort-toggle",{tagName:"button.post-retort",buildKey:function(e){return"retort-toggle-".concat(e.emoji,"-").concat(e.usernames.length)},defaultState:function(e){return{emoji:e.emoji,post:e.post,usernames:e.usernames}},click:function(){var e=this.state,t=e.post,e=e.emoji;r.default.updateRetort(t,e)},html:function(){var e=this.state,t=e.emoji,e=e.usernames;return[(0,i.h)("img.emoji",{src:(0,o.emojiUrlFor)(t),alt:":".concat(t,":")}),1<e.length?(0,i.h)("span.post-retort__count",e.length.toString()):"",(0,i.h)("span.post-retort__tooltip",this.sentence(this.state))]},sentence:function(e){var t,i=e.usernames,e=e.emoji;switch(i.length){case 1:t="retort.reactions.one_person";break;case 2:t="retort.reactions.two_people";break;default:t="retort.reactions.many_people"}return I18n.t(t,{emoji:e,first:i[0],second:i[1],count:i.length-2})}});e.default=t}),define("discourse/plugins/retort/discourse/connectors/above-footer/emoji-picker-wrapper",["exports","../../lib/retort"],function(e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={setupComponent:function(e,t){i.default.setPicker(t)}};e.default=t});
//# sourceMappingURL=/assets/plugins/retort-902b74619e807aea7f5b6d58b8cefaeb0a7b8704eab69a49555fb1836638c331.js.map